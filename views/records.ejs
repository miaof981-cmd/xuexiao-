<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>学生档案</title>
  <link rel="stylesheet" href="/styles.css" />
  <style>
    .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 50; }
    .modal { background:#fff; border-radius: 12px; max-width: 90vw; max-height: 90vh; padding: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
    .modal img { max-width: 86vw; max-height: 80vh; display:block; border-radius: 8px; }
    .modal-close { margin-top:8px; display:inline-block; }
  </style>
</head>
<body>
  <div class="container">
    <h1>学生档案</h1>
    <p>家长：<%= parent.name %>（学号：<%= parent.studentId %>）</p>
    <div class="toolbar">
      <a href="/"><button>返回首页</button></a>
      <a href="/account" style="margin-left:8px"><button>账户设置</button></a>
      <form method="post" action="/logout" style="display:inline-block; margin-left:8px"><button type="submit">退出</button></form>
    </div>

    <% var hasAdmission = records.admissions && records.admissions.length; %>
    <% if (hasAdmission) { var firstAd = records.admissions[0]; } %>
    <div id="admissionModal" class="modal-backdrop" style="display:<%= hasAdmission ? 'flex' : 'none' %>">
      <div class="modal">
        <h3 style="margin:0 0 8px">录取通知书</h3>
        <% if (hasAdmission) { %>
          <img src="<%= firstAd.url %>" alt="录取通知书" />
        <% } %>
        <button type="button" class="modal-close" onclick="document.getElementById('admissionModal').style.display='none'">关闭</button>
      </div>
    </div>

    <div class="masonry">
      <% if (records.admissions && records.admissions.length) { %>
        <% records.admissions.forEach(ad => { %>
          <div class="masonry-item">
            <div class="doc-card">
              <div class="doc-header">
                <div class="doc-title">录取通知书</div>
                <div class="doc-meta"><%= new Date(ad.uploadedAt).toLocaleDateString('zh-CN') %></div>
              </div>
              <div class="doc-body">
                <img src="<%= ad.url %>" alt="admission" style="width:100%; height:auto; border-radius:8px;" />
              </div>
            </div>
          </div>
        <% }) %>
      <% } %>
      <% if (records.reportCards && records.reportCards.length) { %>
        <% records.reportCards.forEach(rc => { %>
          <div class="masonry-item">
            <div class="doc-card">
              <div class="doc-header">
                <div class="doc-title">成绩单</div>
                <div class="doc-meta"><span class="badge"><%= rc.term %></span></div>
              </div>
              <div class="doc-body">
                <div class="report-grid">
                  <div class="score"><span>语文</span><strong><%= rc.chinese %></strong></div>
                  <div class="score"><span>数学</span><strong><%= rc.math %></strong></div>
                  <div class="score"><span>英语</span><strong><%= rc.english %></strong></div>
                  <div class="score"><span>物理</span><strong><%= rc.physics %></strong></div>
                  <div class="score"><span>化学</span><strong><%= rc.chemistry %></strong></div>
                </div>
              </div>
            </div>
          </div>
        <% }) %>
      <% } %>

      <% if (records.punishments && records.punishments.length) { %>
        <% records.punishments.forEach(p => { %>
          <div class="masonry-item">
            <div class="doc-card">
              <div class="doc-header">
                <div class="doc-title">处分单</div>
                <div class="doc-meta"><%= p.date %></div>
              </div>
              <div class="doc-body">
                <div class="punish">
                  <h4>处分类型：<%= p.type %></h4>
                  <p>原因：<%= p.reason %></p>
                </div>
              </div>
            </div>
          </div>
        <% }) %>
      <% } %>

      <% if (records.images && records.images.length) { %>
        <% records.images.forEach(img => { %>
          <div class="masonry-item">
            <div class="doc-card">
              <div class="doc-header">
                <div class="doc-title"><%= img.title || '图片档案' %></div>
                <div class="doc-meta"><%= new Date(img.uploadedAt).toLocaleDateString('zh-CN') %></div>
              </div>
              <div class="doc-body">
                <img src="<%= img.url %>" alt="image" style="width:100%; height:auto; border-radius:8px;" />
                <% if (img.description) { %>
                  <p style="margin-top:8px; color:#4b5563"><%= img.description %></p>
                <% } %>
              </div>
            </div>
          </div>
        <% }) %>
      <% } %>


      <% if ((!records.reportCards || !records.reportCards.length) && (!records.punishments || !records.punishments.length) && (!records.images || !records.images.length) && (!records.admissions || !records.admissions.length)) { %>
        <div class="masonry-item">
          <div class="doc-card">
            <div class="doc-body">
              <p style="margin:0; color:#6b7280; text-align:center">暂无记录</p>
            </div>
          </div>
        </div>
      <% } %>
    </div>
  </div>
</body>
</html>


